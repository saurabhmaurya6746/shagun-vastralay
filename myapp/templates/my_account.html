{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">My Account</h2>
        <p class="text-muted">Welcome, {{ user.username }}</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Account Info -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <h5 class="fw-semibold mb-3">Account Details</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
                        <li class="list-group-item"><strong>Username:</strong> {{ user.username }}</li>
                    </ul>
                </div>
            </div>

            <!-- Toggle Buttons -->
            <div class="text-center mb-3">
                <button id="togglePasswordForm" class="btn btn-outline-dark btn-maroon btn-sm">Change Password</button>
                <button id="backButton" class="btn btn-outline-secondary btn-sm" style="display: none;">‚Üê Back</button>
            </div>

            <!-- Password Change Form -->
            <!-- Password Change Form -->
<div class="card shadow-sm border-0" id="passwordFormCard" style="display: none;">
    <div class="card-body">
        <h5 class="fw-semibold mb-3">Change Password</h5>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        <form method="POST" action="{% url 'my_account' %}">
            {% csrf_token %}
            {{ form.non_field_errors }}
            <div class="mb-3">
                {{ form.old_password.label_tag }}
                {{ form.old_password }}
                {{ form.old_password.errors }}
            </div>
            <div class="mb-3">
                {{ form.new_password1.label_tag }}
                {{ form.new_password1 }}
                {{ form.new_password1.errors }}
            </div>
            <div class="mb-3">
                {{ form.new_password2.label_tag }}
                {{ form.new_password2 }}
                {{ form.new_password2.errors }}
            </div>
            <button type="submit" class="btn btn-maroon">Update Password</button>
        </form>
    </div>
</div>


            <!-- Logout -->
            <div class="mt-4 text-center">
                <a href="{% url 'logout' %}" class="btn btn-outline-danger">Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript to toggle form and back button -->
<script>
  const passwordFormCard = document.getElementById("passwordFormCard");
  const changeBtn = document.getElementById("togglePasswordForm");
  const backBtn = document.getElementById("backButton");

  changeBtn.addEventListener("click", function () {
    passwordFormCard.style.display = "block";
    changeBtn.style.display = "none";
    backBtn.style.display = "inline-block";
  });

  backBtn.addEventListener("click", function () {
    passwordFormCard.style.display = "none";
    changeBtn.style.display = "inline-block";
    backBtn.style.display = "none";
  });
</script>
{% endblock %}
